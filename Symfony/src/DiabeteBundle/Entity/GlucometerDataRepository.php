<?php

namespace DiabeteBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * GlucometerDataRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class GlucometerDataRepository extends EntityRepository
{
	public function getGlucometerData(Subscriber $subscriber, $nbDays) {
		$now = new \DateTime();
		$nbDaysAgo = new \DateTime("-{$nbDays} days");

		$qb = $this->createQueryBuilder('btd')
						->where('btd.subscriber = :subscriber')
						->andWhere('btd.date BETWEEN :nbDaysAgo AND :now')
						->setParameter('subscriber', $subscriber)
						->setParameter('nbDaysAgo', $nbDaysAgo)
						->setParameter('now', $now)
						->orderBy('btd.date','desc');
		return $qb->getQuery()->getResult();
	}
}
